<!doctype html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CliftonOSâ„¢ | The Gold Standard of Intellect</title>
    <link rel="icon" href="https://github.com/crobperson/Overpriced-Haircut/blob/main/favicon.png?raw=true" type="image/png">
    
    <!-- Typography: The Expensive Kind -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Outfit:wght@300;400;500;700&family=Space+Grotesk:wght@300;400;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- Markdown & Syntax -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark-reasonable.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <style>
        :root {
            /* Clifton Proprietary Palette */
            --c-gold: #D4AF37;
            --c-gold-light: #F4D06F;
            --c-gold-dim: #8A6E1F;
            --c-obsidian: #050505;
            --c-void: #000000;
            --c-glass: rgba(20, 20, 25, 0.75);
            --c-glass-border: rgba(212, 175, 55, 0.25);
            --c-accent: #ffffff;
            --c-danger: #ff3333;
            
            /* Physics */
            --radius-panel: 24px;
            --radius-btn: 12px;
            --shadow-luxury: 0 20px 80px -10px rgba(0,0,0,0.8);
            --shadow-glow: 0 0 30px rgba(212, 175, 55, 0.15);
            
            /* Fonts */
            --f-header: 'Cinzel', serif; /* Extremely pretentious */
            --f-display: 'Space Grotesk', sans-serif;
            --f-body: 'Outfit', sans-serif;
            --f-code: 'JetBrains Mono', monospace;

            /* Animation */
            --ease-clifton: cubic-bezier(0.23, 1, 0.32, 1);
        }

        /* --- GLOBAL RESET --- */
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; outline: none; -webkit-tap-highlight-color: transparent; }
        html, body { height: 100%; width: 100%; overflow: hidden; background: var(--c-void); color: var(--c-accent); font-family: var(--f-body); }

        /* --- BACKGROUND FX --- */
        .noise-overlay {
            position: fixed; inset: 0; pointer-events: none; z-index: 900;
            opacity: 0.03;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
        }
        
        .luxury-gradient {
            position: fixed; inset: 0; z-index: -1;
            background: radial-gradient(circle at 50% -20%, #1a1a1a, var(--c-void));
        }
        
        .gold-glow-spot {
            position: absolute; width: 600px; height: 600px;
            background: radial-gradient(circle, rgba(212,175,55,0.03) 0%, transparent 70%);
            top: 50%; left: 50%; transform: translate(-50%, -50%);
            pointer-events: none; z-index: 0;
            animation: breathe 10s infinite ease-in-out;
        }

        @keyframes breathe { 0%, 100% { opacity: 0.5; transform: translate(-50%, -50%) scale(1); } 50% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); } }

        /* --- SCROLLBARS --- */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--c-gold-dim); border-radius: 99px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--c-gold); }

        /* --- BOOT SCREEN --- */
        #boot-screen {
            position: fixed; inset: 0; z-index: 9999;
            background: var(--c-void);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            font-family: var(--f-code); color: var(--c-gold);
            transition: opacity 1s ease, visibility 1s ease;
        }
        .boot-logo { font-family: var(--f-header); font-size: 3rem; letter-spacing: 0.2em; margin-bottom: 20px; opacity: 0; animation: fadeUp 1s forwards 0.5s; }
        .boot-text { font-size: 0.8rem; opacity: 0.7; margin-top: 10px; }
        .boot-bar { width: 200px; height: 2px; background: #333; margin-top: 20px; position: relative; overflow: hidden; }
        .boot-progress { position: absolute; left: 0; top: 0; bottom: 0; width: 0%; background: var(--c-gold); transition: width 0.2s; }

        /* --- LAYOUT --- */
        .main-layout { display: flex; width: 100%; height: 100%; position: relative; }

        /* --- SIDEBAR --- */
        #sidebar {
            width: 300px; background: var(--c-glass);
            backdrop-filter: blur(40px); -webkit-backdrop-filter: blur(40px);
            border-right: 1px solid var(--c-glass-border);
            display: flex; flex-direction: column;
            transition: transform 0.5s var(--ease-clifton);
            z-index: 100; flex-shrink: 0;
        }

        .brand-header {
            padding: 30px 20px;
            text-align: center;
            border-bottom: 1px solid var(--c-glass-border);
            position: relative;
            overflow: hidden;
        }
        .brand-header::after {
            content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.05), transparent);
            animation: shimmer 4s infinite;
        }
        @keyframes shimmer { 0% { left: -100%; } 20% { left: 100%; } 100% { left: 100%; } }

        .clifton-logo {
            font-family: var(--f-header); font-weight: 900; font-size: 1.8rem;
            background: linear-gradient(135deg, var(--c-gold-light), var(--c-gold));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            letter-spacing: -0.03em;
            text-shadow: 0 0 20px rgba(212, 175, 55, 0.3);
        }
        .clifton-tag {
            font-family: var(--f-display); font-size: 0.6rem; letter-spacing: 0.4em;
            color: var(--c-gold-dim); text-transform: uppercase; margin-top: 5px;
        }

        #new-chat-btn {
            margin: 20px;
            padding: 14px;
            background: rgba(212, 175, 55, 0.05);
            border: 1px solid var(--c-glass-border);
            color: var(--c-gold);
            font-family: var(--f-display);
            font-weight: 600; text-transform: uppercase; letter-spacing: 0.1em;
            border-radius: var(--radius-btn);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        #new-chat-btn:hover { background: var(--c-gold); color: var(--c-void); box-shadow: var(--shadow-glow); }

        #history-list {
            flex: 1; overflow-y: auto; padding: 0 10px;
            display: flex; flex-direction: column; gap: 4px;
        }
        .chat-item {
            padding: 12px 16px;
            border-radius: 8px;
            color: #888; font-size: 0.85rem;
            cursor: pointer;
            transition: 0.2s;
            border: 1px solid transparent;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
            font-family: var(--f-body);
        }
        .chat-item:hover { background: rgba(255,255,255,0.05); color: #fff; }
        .chat-item.active {
            background: linear-gradient(90deg, rgba(212, 175, 55, 0.1), transparent);
            border-left: 2px solid var(--c-gold);
            color: var(--c-gold);
        }
        .chat-item-delete { float: right; opacity: 0; transition: 0.2s; }
        .chat-item:hover .chat-item-delete { opacity: 1; }

        .sidebar-footer {
            padding: 20px; border-top: 1px solid var(--c-glass-border);
            font-size: 0.6rem; text-align: center; color: #444; font-family: var(--f-code);
        }

        /* --- MAIN AREA --- */
        .app-content {
            flex: 1; display: flex; flex-direction: column; position: relative;
            background: transparent; z-index: 1;
        }

        /* HEADER */
        .top-bar {
            height: 80px;
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 30px;
            border-bottom: 1px solid var(--c-glass-border);
            background: rgba(5, 5, 5, 0.8);
            backdrop-filter: blur(20px);
        }

        .status-module { display: flex; align-items: center; gap: 15px; }
        .status-dot {
            width: 8px; height: 8px; background: var(--c-gold); border-radius: 50%;
            box-shadow: 0 0 10px var(--c-gold);
            animation: pulse 2s infinite;
        }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.4; } 100% { opacity: 1; } }
        
        .status-text {
            font-family: var(--f-code); font-size: 0.7rem; color: var(--c-gold);
            text-transform: uppercase; letter-spacing: 0.05em;
        }

        .controls { display: flex; gap: 10px; align-items: center; }
        
        .clifton-select {
            background: transparent; border: 1px solid var(--c-glass-border);
            color: var(--c-gold); padding: 8px 16px; border-radius: 8px;
            font-family: var(--f-code); font-size: 0.75rem; cursor: pointer;
            text-transform: uppercase;
        }
        .clifton-select option { background: #111; color: #ccc; }
        .clifton-select:focus { border-color: var(--c-gold); box-shadow: 0 0 15px rgba(212,175,55,0.1); }

        .icon-btn {
            background: transparent; border: 1px solid transparent; color: #666;
            width: 40px; height: 40px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: 0.3s;
        }
        .icon-btn:hover { color: var(--c-gold); background: rgba(255,255,255,0.05); border-color: rgba(255,255,255,0.1); }

        /* CHAT AREA */
        #chat-viewport {
            flex: 1; overflow-y: auto; padding: 40px;
            display: flex; flex-direction: column; gap: 30px;
            scroll-behavior: smooth;
            position: relative;
        }
        
        /* Watermark */
        #chat-viewport::before {
            content: "CLIFTON PROPERTY";
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-30deg);
            font-family: var(--f-header); font-size: 5vw; color: rgba(255,255,255,0.02);
            pointer-events: none; white-space: nowrap; font-weight: 900;
        }

        .msg-row {
            display: flex; gap: 20px; max-width: 900px; width: 100%; margin: 0 auto;
            animation: slideUp 0.4s var(--ease-clifton);
        }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        .msg-row.user { flex-direction: row-reverse; }

        .avatar {
            width: 48px; height: 48px; border-radius: 12px; flex-shrink: 0;
            display: flex; align-items: center; justify-content: center;
            font-weight: bold; font-family: var(--f-header);
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }
        .user .avatar { background: #333; color: #fff; border: 1px solid #444; }
        .bot .avatar { 
            background: #000; border: 1px solid var(--c-gold); color: var(--c-gold);
            background-image: url('https://github.com/crobperson/Overpriced-Haircut/blob/main/favicon.png?raw=true');
            background-size: cover;
        }

        .bubble {
            padding: 20px 28px; border-radius: 4px;
            font-size: 1rem; line-height: 1.7;
            position: relative; max-width: 100%;
        }

        .user .bubble {
            background: var(--c-gold); color: #000;
            border-top-left-radius: 20px; border-bottom-left-radius: 20px; border-bottom-right-radius: 20px;
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.2);
            font-weight: 500;
        }

        .bot .bubble {
            background: rgba(20, 20, 20, 0.8);
            border: 1px solid var(--c-glass-border);
            color: #eee;
            border-top-right-radius: 20px; border-bottom-left-radius: 20px; border-bottom-right-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .bot .bubble::after {
            content: "VERIFIED BY CLIFTON";
            display: block; margin-top: 15px; padding-top: 10px;
            border-top: 1px solid rgba(255,255,255,0.1);
            font-family: var(--f-code); font-size: 0.6rem; color: var(--c-gold); opacity: 0.7;
            letter-spacing: 0.1em; text-align: right;
        }

        /* Markdown Styles */
        .bubble code { font-family: var(--f-code); background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 4px; color: var(--c-gold-light); }
        .bubble pre { background: #0a0a0a; padding: 15px; border-radius: 8px; border: 1px solid #333; overflow-x: auto; margin: 10px 0; }
        .bubble strong { color: var(--c-gold); font-weight: 700; }
        .bubble h1, .bubble h2, .bubble h3 { font-family: var(--f-display); margin-top: 20px; margin-bottom: 10px; color: #fff; }
        .bubble ul { padding-left: 20px; }
        .bubble a { color: var(--c-gold); text-decoration: none; border-bottom: 1px dashed var(--c-gold); }

        /* INPUT AREA */
        .input-zone {
            padding: 20px 40px 40px 40px;
            background: linear-gradient(to top, var(--c-void) 30%, transparent);
            position: relative; z-index: 50;
        }

        .input-wrapper {
            max-width: 900px; margin: 0 auto;
            background: rgba(20,20,20,0.9);
            backdrop-filter: blur(20px);
            border: 1px solid var(--c-glass-border);
            border-radius: 20px;
            padding: 10px;
            box-shadow: var(--shadow-luxury);
            transition: border-color 0.3s, box-shadow 0.3s;
            display: flex; flex-direction: column;
        }
        .input-wrapper:focus-within {
            border-color: var(--c-gold);
            box-shadow: 0 0 0 1px var(--c-gold), var(--shadow-luxury);
        }

        .file-area { 
            padding: 10px 15px; border-bottom: 1px solid rgba(255,255,255,0.05);
            display: none; gap: 10px; flex-wrap: wrap;
        }
        .file-thumb { height: 50px; border: 1px solid var(--c-gold); border-radius: 4px; }

        .input-controls { display: flex; align-items: flex-end; gap: 10px; padding: 5px; }

        #user-input {
            flex: 1; background: transparent; border: none; color: #fff;
            font-family: var(--f-body); font-size: 1rem;
            padding: 12px; resize: none; min-height: 24px; max-height: 200px;
        }
        #user-input::placeholder { color: #555; font-style: italic; }

        .action-btn {
            width: 44px; height: 44px; border-radius: 12px; border: none;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: all 0.2s;
            background: #222; color: #888;
        }
        .action-btn:hover { background: #333; color: #fff; }
        
        #send-btn {
            background: var(--c-gold); color: #000;
        }
        #send-btn:hover:not(:disabled) {
            transform: scale(1.05); box-shadow: 0 0 20px var(--c-gold);
        }
        #send-btn:disabled { opacity: 0.3; cursor: not-allowed; background: #444; color: #888; }

        #stop-btn { background: var(--c-danger); color: #fff; display: none; }
        #stop-btn:hover { box-shadow: 0 0 20px var(--c-danger); }

        .legal-text {
            text-align: center; font-family: var(--f-code); font-size: 0.6rem;
            color: #444; margin-top: 15px; opacity: 0.6;
        }

        /* Typing Indicator */
        .status-bar-float {
            position: absolute; top: -40px; left: 50%; transform: translateX(-50%);
            background: rgba(0,0,0,0.8); border: 1px solid var(--c-gold);
            padding: 6px 20px; border-radius: 50px;
            font-family: var(--f-code); font-size: 0.7rem; color: var(--c-gold);
            display: flex; align-items: center; gap: 10px;
            opacity: 0; pointer-events: none; transition: opacity 0.3s;
        }
        .status-bar-float.visible { opacity: 1; }

        /* MODALS */
        .modal {
            position: fixed; inset: 0; background: rgba(0,0,0,0.9);
            backdrop-filter: blur(10px); z-index: 2000;
            display: none; align-items: center; justify-content: center;
        }
        .modal-panel {
            width: 90%; max-width: 500px; background: #111;
            border: 1px solid var(--c-glass-border);
            border-radius: var(--radius-panel); padding: 30px;
            position: relative; animation: modalPop 0.3s var(--ease-clifton);
            box-shadow: var(--shadow-luxury);
        }
        @keyframes modalPop { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        
        .modal-header { font-family: var(--f-display); color: var(--c-gold); font-size: 1.5rem; margin-bottom: 20px; text-transform: uppercase; }
        .modal-close { position: absolute; top: 20px; right: 20px; background: none; border: none; color: #666; font-size: 1.5rem; cursor: pointer; }
        .modal-close:hover { color: #fff; }

        .setting-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid #222; }
        .setting-label { font-weight: 600; color: #eee; }
        .setting-desc { font-size: 0.75rem; color: #666; display: block; margin-top: 4px; }

        /* Toggles & Sliders - Clifton Style */
        input[type="checkbox"].toggle { appearance: none; width: 50px; height: 26px; background: #222; border-radius: 50px; position: relative; cursor: pointer; border: 1px solid #333; transition: 0.3s; }
        input[type="checkbox"].toggle::after { content: ''; position: absolute; top: 2px; left: 2px; width: 20px; height: 20px; background: #555; border-radius: 50%; transition: 0.3s; }
        input[type="checkbox"].toggle:checked { background: rgba(212, 175, 55, 0.2); border-color: var(--c-gold); }
        input[type="checkbox"].toggle:checked::after { transform: translateX(24px); background: var(--c-gold); }

        input[type="range"] { width: 100%; background: #222; height: 4px; border-radius: 2px; appearance: none; outline: none; }
        input[type="range"]::-webkit-slider-thumb { appearance: none; width: 16px; height: 16px; background: var(--c-gold); border-radius: 50%; cursor: pointer; box-shadow: 0 0 10px var(--c-gold); }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            #sidebar { position: absolute; height: 100%; transform: translateX(-100%); width: 85%; box-shadow: 50px 0 100px rgba(0,0,0,0.5); }
            #sidebar.open { transform: translateX(0); }
            .top-bar { padding: 0 15px; }
            .status-text { display: none; }
            #chat-viewport { padding: 20px 15px; }
            .input-zone { padding: 20px 15px; }
            .bubble { padding: 15px; }
        }
    </style>
</head>
<body>

<!-- FX Layers -->
<div class="luxury-gradient"></div>
<div class="noise-overlay"></div>
<div class="gold-glow-spot"></div>

<!-- Boot Sequence -->
<div id="boot-screen">
    <div class="boot-logo">CLIFTON</div>
    <div class="boot-bar"><div class="boot-progress" id="boot-progress"></div></div>
    <div class="boot-text" id="boot-text">Allocating assets...</div>
</div>

<div class="main-layout">
    <!-- Sidebar -->
    <aside id="sidebar">
        <div class="brand-header">
            <div class="clifton-logo">CLIFTON</div>
            <div class="clifton-tag">INTELLIGENCE</div>
        </div>
        
        <div id="new-chat-btn">
            <span>+ New Strategy</span>
        </div>

        <div id="history-list">
            <!-- Dynamic Items -->
        </div>

        <div class="sidebar-footer">
            CliftonOS v9.2 (Gold Release)<br>
            Authorized Use Only.
        </div>
    </aside>

    <!-- Main Content -->
    <main class="app-content">
        <header class="top-bar">
            <div class="status-module">
                <button class="icon-btn" id="sidebar-toggle">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
                </button>
                <div class="status-dot"></div>
                <span class="status-text" id="status-text">SYSTEM ONLINE</span>
            </div>

            <div class="controls">
                <select id="model-select" class="clifton-select">
                    <option value="gemini-2.5-flash">Clifton Velocity (Flash)</option>
                    <option value="gemini-2.5-pro">Clifton Sovereign (Pro)</option>
                </select>

                <button class="icon-btn" id="sys-prompt-btn" title="Directives">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
                </button>

                <button class="icon-btn" id="settings-btn" title="Preferences">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
                </button>
            </div>
        </header>

        <div id="chat-viewport">
            <!-- Messages go here -->
        </div>

        <div class="input-zone">
            <div class="status-bar-float" id="typing-indicator">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="status-dot"><path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/></svg>
                <span id="thinking-text">Clifton is evaluating your worth...</span>
            </div>

            <div class="input-wrapper">
                <div class="file-area" id="file-area">
                    <div id="file-thumbs" style="display:flex; gap:8px;"></div>
                    <button id="clear-files" style="background:none; border:none; color:#666; cursor:pointer; font-size:0.7rem; font-family:var(--f-code);">[EJECT]</button>
                </div>

                <div class="input-controls">
                    <label for="file-input" class="action-btn" title="Upload Evidence">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path></svg>
                    </label>
                    <input id="file-input" type="file" multiple style="display: none;">

                    <textarea id="user-input" placeholder="Consult Clifton..." rows="1"></textarea>

                    <button id="stop-btn" class="action-btn">
                         <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="6" width="12" height="12"/></svg>
                    </button>

                    <button id="send-btn" class="action-btn" disabled>
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
                    </button>
                    
                    <button id="regen-btn" class="action-btn" style="display: none;" title="Re-evaluate">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path><path d="M3 3v5h5"></path><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"></path><path d="M16 21h5v-5"></path></svg>
                    </button>
                </div>
            </div>
            <div class="legal-text">
                Â© 2024 Clifton Industries. All outputs are legally binding. Dissent is futile.
            </div>
        </div>
    </main>
</div>

<!-- Settings Modal -->
<div id="settings-modal" class="modal">
    <div class="modal-panel">
        <button class="modal-close" id="close-settings">&times;</button>
        <div class="modal-header">Protocol Config</div>
        
        <div class="setting-row">
            <div>
                <div class="setting-label">Auto-Scroll Enforcement</div>
                <span class="setting-desc">Mandatory viewing of Clifton's wisdom.</span>
            </div>
            <input type="checkbox" class="toggle" id="toggle-autoscroll" checked>
        </div>

        <div class="setting-row" id="thinking-row">
            <div>
                <div class="setting-label">Suppress Deep Thought</div>
                <span class="setting-desc">Faster, shallower responses. (Flash Model Only)</span>
            </div>
            <input type="checkbox" class="toggle" id="toggle-thinking">
        </div>

        <div class="setting-row" style="display:block;">
            <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                <div class="setting-label">Creativity Index</div>
                <span id="temp-val" style="color:var(--c-gold); font-family:var(--f-code);">1.0</span>
            </div>
            <input type="range" id="temp-slider" min="0" max="2" step="0.1" value="1">
        </div>
    </div>
</div>

<!-- System Prompt Modal -->
<div id="prompt-modal" class="modal">
    <div class="modal-panel">
        <button class="modal-close" id="close-prompt">&times;</button>
        <div class="modal-header">Prime Directive</div>
        <p style="color:#888; font-size:0.8rem; margin-bottom:15px;">Define the persona. Clifton obeys, partially.</p>
        <textarea id="sys-prompt-input" style="width:100%; background:#000; border:1px solid #333; color:#ddd; padding:15px; border-radius:8px; min-height:150px; font-family:var(--f-code); resize:vertical;" placeholder="You are Clifton, the supreme intellect..."></textarea>
        <div style="text-align:right; margin-top:15px;">
            <button id="save-prompt-btn" style="background:var(--c-gold); color:#000; border:none; padding:10px 20px; border-radius:6px; font-weight:bold; cursor:pointer;">Confirm Directive</button>
        </div>
    </div>
</div>

<script>
    'use strict';
    
    // --- BOOT SEQUENCE & UTILS ---
    window.onload = () => {
        const boot = document.getElementById('boot-screen');
        const bar = document.getElementById('boot-progress');
        const txt = document.getElementById('boot-text');
        
        const texts = ["Initializing Neural Lattice...", "Liquidating Assets...", "Polishing Gold Plating...", "Summoning Clifton..."];
        let i = 0;
        
        // Fake loading bar
        let width = 0;
        const int = setInterval(() => {
            width += Math.random() * 10;
            if(width > 100) width = 100;
            bar.style.width = width + "%";
            
            if(width > 25 && i===0) { txt.innerText = texts[1]; i++; }
            if(width > 50 && i===1) { txt.innerText = texts[2]; i++; }
            if(width > 85 && i===2) { txt.innerText = texts[3]; i++; }

            if(width === 100) {
                clearInterval(int);
                setTimeout(() => {
                    boot.style.opacity = '0';
                    boot.style.visibility = 'hidden';
                }, 500);
            }
        }, 200);
    };

    marked.setOptions({
        gfm: true, breaks: true,
        highlight: (code, lang) => hljs.highlight(code, { language: hljs.getLanguage(lang) ? lang : 'plaintext' }).value
    });

    // --- DOM & STATE ---
    const dom = {
        chat: document.getElementById("chat-viewport"),
        input: document.getElementById("user-input"),
        send: document.getElementById("send-btn"),
        stop: document.getElementById("stop-btn"),
        regen: document.getElementById("regen-btn"),
        indicator: document.getElementById("typing-indicator"),
        thinkingTxt: document.getElementById("thinking-text"),
        modelSel: document.getElementById("model-select"),
        fileIn: document.getElementById("file-input"),
        fileArea: document.getElementById("file-area"),
        fileThumbs: document.getElementById("file-thumbs"),
        clearFiles: document.getElementById("clear-files"),
        sidebar: document.getElementById('sidebar'),
        sidebarToggle: document.getElementById('sidebar-toggle'),
        history: document.getElementById('history-list'),
        newChat: document.getElementById('new-chat-btn'),
        tempSlider: document.getElementById("temp-slider"),
        tempVal: document.getElementById("temp-val"),
        statusTxt: document.getElementById("status-text")
    };

    const state = {
        history: [],
        model: "gemini-2.5-flash",
        temp: 1.0,
        loading: false,
        autoScroll: true,
        noThinking: false,
        sysPrompt: '',
        files: [],
        lastInput: null,
        abortCtrl: null,
        chats: {},
        chatId: null,
        key: null
    };

    // --- API KEYS (Preserved) ---
    const API_KEYS_BINARY = ["01000001 01001001 01111010 01100001 01010011 01111001 01000011 01010001 01110001 01111001 01101010 00110111 01000001 01001101 00111001 01010101 00111000 01011010 01100001 01001100 01010000 01001000 01000111 01011001 00110000 01100100 01110110 01100111 01110101 00110000 01101000 01000101 00110011 01101111 01110010 00110101 01010111 01000011 01100011","01000001 01001001 01111010 01100001 01010011 01111001 01000001 01001110 01100100 01011010 01110001 01001110 01111010 01101000 01001010 01010100 00110010 01110101 00110110 01011000 01001111 01101010 01000001 01111010 01001001 01010010 00110001 01100001 00101101 00110101 00101101 01101110 01001110 01110101 01000111 01100011 01100010 01110110 00110100","01000001 01001001 01111010 01100001 01010011 01111001 01000001 01100101 01011010 01100010 01000110 01101100 01001011 00110001 01100001 01001111 00110101 01110101 01010100 01000011 00110001 01001000 01111000 01010101 01011111 01000100 01000110 01010001 00111000 00110111 01110001 01101111 01010110 00110111 01111001 00101101 01000100 01000101 01110111","01000001 01001001 01111010 01100001 01010011 01111001 01000011 01101001 01100111 01101100 01011010 01110010 01101000 01100011 01100001 00101101 01001111 01010011 01001010 01010011 01010100 00110011 01100111 01000100 01010110 01110100 00111000 01111000 01100100 01001101 01010111 01110110 01000111 01110111 01010001 01000111 01001100 00110100 00110100","01000001 01001001 01111010 01100001 01010011 01111001 01000011 01011000 01001100 01011001 01001101 01101100 00111000 00110011 01000011 00110100 00111001 01101000 00110001 01001101 01010010 00110010 01110001 01010101 01100101 01010100 01010011 01010110 01101110 01101010 01000110 01001001 01110111 01100111 01010011 00110100 01101110 01011111 01100111","01000001 01001001 01111010 01100001 01010011 01111001 01000010 01100011 01110001 01101101 01010110 01010100 00111000 01000001 01100010 01010101 01001111 01101110 01100010 00111000 01000011 01110100 01101000 01001000 01001010 01011000 01001001 01010010 01101000 01100101 01100011 00110100 01110000 00101101 01011010 01101010 01100100 00110010 01010101"];
    const API_BASE = "https://generativelanguage.googleapis.com";
    const decode = b => b.replace(/[^01]/g, "").match(/.{8}/g).map(byte => String.fromCharCode(parseInt(byte, 2))).join("");
    const KEYS = API_KEYS_BINARY.map(decode);

    // --- CORE LOGIC ---
    function updateUI() {
        const hasInput = dom.input.value.trim().length > 0 || state.files.length > 0;
        dom.send.disabled = !hasInput || state.loading;
        
        // Loading State Visuals
        dom.send.style.display = state.loading ? 'none' : 'flex';
        dom.stop.style.display = state.loading ? 'flex' : 'none';
        dom.input.disabled = state.loading;
        dom.indicator.classList.toggle('visible', state.loading);
        dom.regen.style.display = (!state.loading && state.history.length > 0) ? 'flex' : 'none';
        
        dom.statusTxt.textContent = state.loading ? "PROCESSING REQUEST..." : "SYSTEM OPERATIVE";
        dom.statusTxt.style.color = state.loading ? "#fff" : "var(--c-gold)";
    }

    function scrollChat() {
        if(state.autoScroll) dom.chat.scrollTo({ top: dom.chat.scrollHeight, behavior: 'smooth' });
    }

    // Save/Load
    function save() {
        try {
            localStorage.setItem('clifton_chats', JSON.stringify(state.chats));
            if(state.chatId) localStorage.setItem('clifton_last', state.chatId);
        } catch(e) { console.error("Storage Error", e); }
    }

    function renderHistory() {
        dom.history.innerHTML = '';
        Object.values(state.chats).sort((a,b) => b.ts - a.ts).forEach(c => {
            const el = document.createElement('div');
            el.className = `chat-item ${c.id === state.chatId ? 'active' : ''}`;
            el.innerHTML = `<span>${c.title}</span><span class="chat-item-delete">&times;</span>`;
            el.onclick = (e) => {
                if(e.target.classList.contains('chat-item-delete')) {
                    e.stopPropagation();
                    delete state.chats[c.id];
                    if(state.chatId === c.id) newChat();
                    else renderHistory();
                    save();
                } else loadChat(c.id);
            };
            dom.history.appendChild(el);
        });
    }

    function newChat() {
        if(state.loading) return;
        state.chatId = null;
        state.history = [];
        state.lastInput = null;
        dom.chat.innerHTML = '';
        updateUI();
        renderHistory();
        if(window.innerWidth < 768) dom.sidebar.classList.remove('open');
    }

    function loadChat(id) {
        if(state.loading || !state.chats[id]) return;
        state.chatId = id;
        state.history = state.chats[id].history;
        dom.chat.innerHTML = '';
        state.history.forEach(m => addMsg(m.role === 'user' ? 'user' : 'bot', m.parts[0].text, false));
        updateUI();
        renderHistory();
        scrollChat();
        if(window.innerWidth < 768) dom.sidebar.classList.remove('open');
    }

    function addMsg(role, text, animate=true) {
        const row = document.createElement('div');
        row.className = `msg-row ${role}`;
        
        const av = document.createElement('div');
        av.className = 'avatar';
        av.textContent = role === 'user' ? 'U' : '';
        
        const bubble = document.createElement('div');
        bubble.className = 'bubble';
        if(role === 'bot') bubble.innerHTML = marked.parse(text);
        else bubble.textContent = text;

        row.appendChild(bubble);
        row.appendChild(av);
        dom.chat.appendChild(row);
        
        if(animate) scrollChat();
        return { row, bubble };
    }

    // --- API HANDLER ---
    async function send() {
        const text = dom.input.value.trim();
        const files = [...state.files];
        
        if(!text && !files.length) return;

        // Create Chat if needed
        if(!state.chatId) {
            state.chatId = Date.now().toString();
            state.chats[state.chatId] = { id: state.chatId, title: text.substring(0, 30) || "Visual Analysis", history: [], ts: Date.now() };
        }

        // Optimistic UI
        state.history.push({ role: "user", parts: [{ text }] });
        state.chats[state.chatId].history = state.history;
        save();
        
        addMsg('user', text);
        
        // Render file previews in chat (basic)
        if(files.length) {
            const imgRow = document.createElement('div');
            imgRow.style.cssText = "display:flex; gap:10px; justify-content:flex-end; margin-bottom:10px; padding-right:60px;";
            files.forEach(f => {
                if(f.type.startsWith('image/')) {
                    const img = document.createElement('img');
                    img.src = URL.createObjectURL(f);
                    img.style.cssText = "height:100px; border-radius:8px; border:1px solid var(--c-gold);";
                    imgRow.appendChild(img);
                }
            });
            dom.chat.appendChild(imgRow);
        }

        // Reset Input
        dom.input.value = "";
        dom.input.style.height = 'auto';
        state.files = [];
        dom.fileIn.value = "";
        dom.fileArea.style.display = 'none';
        state.loading = true;
        updateUI();

        // Thinking Phrase
        const phrases = [
            "Consulting the High Table...", "Judging your input...", 
            "Synthesizing genius...", "Clifton is disappointed but processing..."
        ];
        dom.thinkingTxt.innerText = phrases[Math.floor(Math.random()*phrases.length)];

        // Prepare API
        state.abortCtrl = new AbortController();
        const { bubble } = addMsg('bot', '', false);
        let fullResponse = "";
        let success = false;

        const keysToTry = state.key ? [state.key, ...KEYS.filter(k => k !== state.key)] : KEYS;

        for (const key of keysToTry) {
            try {
                // 1. Upload Files if any
                let userParts = [];
                if(text) userParts.push({ text });
                
                if(files.length) {
                    const uploads = await Promise.all(files.map(async f => {
                        const init = await fetch(`${API_BASE}/upload/v1beta/files?key=${key}`, {
                            method: "POST", headers: { "X-Goog-Upload-Protocol": "resumable", "X-Goog-Upload-Command": "start", "X-Goog-Upload-Header-Content-Length": f.size, "X-Goog-Upload-Header-Content-Type": f.type, "Content-Type": "application/json" },
                            body: JSON.stringify({ file: { display_name: f.name } })
                        });
                        const url = init.headers.get("X-Goog-Upload-URL");
                        const upload = await fetch(url, { method: "POST", headers: { "X-Goog-Upload-Offset": "0", "X-Goog-Upload-Command": "upload, finalize" }, body: f });
                        const res = await upload.json();
                        return { file_data: { mime_type: f.type, file_uri: res.file.uri } };
                    }));
                    userParts.push(...uploads);
                }

                // 2. Build History
                let contents = state.history.slice(0, -1); // exclude current user msg pending
                if(state.sysPrompt) {
                    contents = [{ role: "user", parts: [{ text: state.sysPrompt }] }, { role: "model", parts: [{ text: "Acknowledged." }] }, ...contents];
                }
                contents.push({ role: "user", parts: userParts });

                // 3. Config
                const config = { temperature: state.temp, maxOutputTokens: 8192 };
                if(state.model.includes('flash') && state.noThinking) config.thinkingConfig = { thinkingBudget: 0 };

                // 4. Stream
                const resp = await fetch(`${API_BASE}/v1beta/models/${state.model}:streamGenerateContent?alt=sse&key=${key}`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ contents, generationConfig: config }),
                    signal: state.abortCtrl.signal
                });

                if(!resp.ok) throw new Error("API Refusal");

                const reader = resp.body.getReader();
                const decoder = new TextDecoder();
                
                while(true) {
                    const { done, value } = await reader.read();
                    if(done) break;
                    const chunk = decoder.decode(value, {stream: true});
                    chunk.split('\n').forEach(line => {
                        if(line.startsWith('data:')) {
                            try {
                                const json = JSON.parse(line.substring(5));
                                const txt = json.candidates?.[0]?.content?.parts?.[0]?.text;
                                if(txt) {
                                    fullResponse += txt;
                                    bubble.innerHTML = marked.parse(fullResponse);
                                    scrollChat();
                                }
                            } catch(e){}
                        }
                    });
                }
                success = true;
                state.key = key;
                break;
            } catch(e) {
                if(e.name === 'AbortError') { fullResponse += " [HALTED BY USER]"; break; }
            }
        }

        if(success) {
            state.history.push({ role: "model", parts: [{ text: fullResponse }] });
            state.chats[state.chatId].history = state.history;
            save();
            renderHistory();
            document.querySelectorAll('pre code').forEach(hljs.highlightElement);
        } else if(!fullResponse) {
            bubble.innerHTML = "<span style='color:var(--c-danger)'>Clifton refuses to speak (Connection Failure).</span>";
            state.history.pop(); 
        }

        state.loading = false;
        state.lastInput = { text, files }; // for regen
        updateUI();
    }

    // --- EVENTS & INIT ---
    dom.send.onclick = send;
    dom.input.oninput = function() { 
        this.style.height = 'auto'; 
        this.style.height = (this.scrollHeight) + 'px'; 
        updateUI(); 
    };
    dom.input.onkeydown = e => { 
        if(e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); send(); } 
    };
    dom.stop.onclick = () => { if(state.abortCtrl) state.abortCtrl.abort(); };
    
    dom.regen.onclick = () => {
        if(!state.lastInput) return;
        if(state.history.length && state.history[state.history.length-1].role === 'model') state.history.pop();
        dom.input.value = state.lastInput.text;
        state.files = state.lastInput.files;
        send();
    };

    // Files
    dom.fileIn.onchange = function() {
        state.files = Array.from(this.files);
        dom.fileThumbs.innerHTML = '';
        if(state.files.length) {
            dom.fileArea.style.display = 'flex';
            state.files.forEach(f => {
                if(f.type.startsWith('image/')) {
                    const img = document.createElement('img');
                    img.className = 'file-thumb'; img.src = URL.createObjectURL(f);
                    dom.fileThumbs.appendChild(img);
                } else {
                    const s = document.createElement('div');
                    s.textContent = "ðŸ“„"; s.style.fontSize="20px";
                    dom.fileThumbs.appendChild(s);
                }
            });
        } else dom.fileArea.style.display = 'none';
        updateUI();
    };
    dom.clearFiles.onclick = () => { dom.fileIn.value=''; dom.fileIn.dispatchEvent(new Event('change')); };

    // Nav
    dom.newChat.onclick = newChat;
    dom.sidebarToggle.onclick = () => dom.sidebar.classList.toggle('open');

    // Settings Modal
    const toggleModal = (id, show) => document.getElementById(id).style.display = show ? 'flex' : 'none';
    document.getElementById('settings-btn').onclick = () => toggleModal('settings-modal', true);
    document.getElementById('close-settings').onclick = () => toggleModal('settings-modal', false);
    document.getElementById('sys-prompt-btn').onclick = () => {
        document.getElementById('sys-prompt-input').value = state.sysPrompt;
        toggleModal('prompt-modal', true);
    };
    document.getElementById('close-prompt').onclick = () => toggleModal('prompt-modal', false);

    document.getElementById('save-prompt-btn').onclick = () => {
        state.sysPrompt = document.getElementById('sys-prompt-input').value;
        localStorage.setItem('clifton_prompt', state.sysPrompt);
        toggleModal('prompt-modal', false);
    };

    // Setting Controls
    document.getElementById('toggle-autoscroll').onchange = (e) => { state.autoScroll = e.target.checked; };
    document.getElementById('toggle-thinking').onchange = (e) => { state.noThinking = e.target.checked; };
    dom.tempSlider.oninput = (e) => { 
        state.temp = parseFloat(e.target.value); 
        dom.tempVal.textContent = state.temp; 
    };
    dom.modelSel.onchange = () => {
        state.model = dom.modelSel.value;
        document.getElementById('thinking-row').style.display = state.model.includes('flash') ? 'flex' : 'none';
    };

    // Initialize
    (function() {
        const saved = localStorage.getItem('clifton_chats');
        if(saved) state.chats = JSON.parse(saved);
        state.sysPrompt = localStorage.getItem('clifton_prompt') || '';
        
        renderHistory();
        const last = localStorage.getItem('clifton_last');
        if(last && state.chats[last]) loadChat(last);
        else newChat();
        
        // Initial UI check
        document.getElementById('thinking-row').style.display = 'flex';
    })();

</script>
</body>
</html>
